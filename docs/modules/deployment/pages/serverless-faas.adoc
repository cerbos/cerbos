include::ROOT:partial$attributes.adoc[]

= Deploy Cerbos to Serverless/FaaS environments

include::ROOT:partial$version-check.adoc[]


== AWS Lambda

[NOTE]
====
Cerbos is a CPU-bound application. On AWS Lambda environments CPU is not individually configurable and is determined as a function of allocated memory (see link:https://docs.aws.amazon.com/lambda/latest/dg/configuration-memory.html). If you're experiencing slow response times from Cerbos, increase the memory allocation. Even though neither Cerbos nor your code requires a lot of memory, the architecture of AWS Lambda forces this counter-intuitive tuning advice.

Because each application is different, we can't provide any recommendations. Monitor your application and tune the memory allocation until the performance is satisfactory for your needs.   
====

Cerbos provides two deployment options for AWS Lambda:

=== Cerbos Lambda Function

Deploy Cerbos as a standalone AWS Lambda function that handles authorization requests directly. This deployment pattern is suitable for centralized authorization services.

Download the specially-built `cerbosfunc` binary from the link:{app-github-releases-page}[releases page], which can be deployed as either a Zip package or a container image. 

.SAM template for Lambda Function deployment
[source,yaml]
----
include::example$sam-function.yml[]
----

=== Cerbos Lambda Extension (Layer)

Deploy Cerbos as a Lambda extension layer that runs alongside your application function. This deployment pattern is similar to a sidecar deployment.

Download the specially-built `cerbosext` binary from the link:{app-github-releases-page}[releases page], which can be deployed as a Zip layer.

.SAM template for Lambda Extension deployment
[source,yaml]
----
include::example$sam-extension.yml[]
----

=== Comparison: Function vs Extension

[cols="1,1,1"]
|===
|Aspect |Lambda Function |Lambda Extension

|**Deployment Pattern**
|Centralized service
|Sidecar pattern

|**Resource Sharing**
|Dedicated Lambda execution
|Shares execution with application function

|**Cold Start**
|Independent cold start
|Shared cold start with application

|**Network Overhead**
|API Gateway + Lambda runtime
|Direct process communication

|**Use Case**
|Central authorization service
|Embedded authorization for specific functions

|**Scaling**
|Independent scaling
|Scales with application function
|===

Both deployment options use AWS SAM (Serverless Application Model) templates for easy deployment and include example configurations for policies, logging, and API Gateway integration.
