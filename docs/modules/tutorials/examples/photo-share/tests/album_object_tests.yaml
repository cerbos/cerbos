---
name: AlbumObjectTestSuite
description: Tests for verifying the album:object resource policy
tests:
  - name: Alicia tries to view her own private album
    request: {
      "requestId": "test",
      "actions": ["view"],
      "principal": {
        "id": "alicia",
        "roles": ["user"]
      },
      "resource": {
        "name": "album:object",
        "instances": {
          "XX125": {
            "attr": {
              "owner": "alicia",
              "id": "XX125",
              "public": false,
              "flagged": false
            }
          }
        }
      }
    }
    expected: {
      "XX125": {
        "actions": {
          "view": "EFFECT_ALLOW"
        }
      }
    }

  - name: Bradley tries to view Alicia's private and public albums
    request: {
      "requestId": "test",
      "actions": ["view"],
      "principal": {
        "id": "bradley",
        "roles": ["user"]
      },
      "resource": {
        "name": "album:object",
        "instances": {
          "PRIVATE": {
            "attr": {
              "owner": "alicia",
              "id": "XX125",
              "public": false,
              "flagged": false
            }
          },
          "PUBLIC": {
            "attr": {
              "owner": "alicia",
              "id": "XX525",
              "public": true,
              "flagged": false
            }
          }
        }
      }
    }
    expected: {
      "PRIVATE": {
        "actions": {
          "view": "EFFECT_DENY"
        }
      },
      "PUBLIC": {
        "actions": {
          "view": "EFFECT_ALLOW"
        }
      }
    }

  - name: Moderator tries to delete a flagged album and an unflagged album
    request: {
      "requestId": "test",
      "actions": ["delete"],
      "principal": {
        "id": "maria",
        "roles": ["user", "moderator"]
      },
      "resource": {
        "name": "album:object",
        "instances": {
          "UNFLAGGED": {
            "attr": {
              "owner": "alicia",
              "id": "XX525",
              "public": true,
              "flagged": false
            }
          },
          "FLAGGED": {
            "attr": {
              "owner": "evan",
              "id": "XX666",
              "public": true,
              "flagged": true
            }
          }
        }
      }
    }
    expected: {
      "UNFLAGGED": {
        "actions": {
          "delete": "EFFECT_DENY"
        }
      },
      "FLAGGED": {
        "actions": {
          "delete": "EFFECT_ALLOW"
        }
      }
    }
