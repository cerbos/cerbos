---
apiVersion: api.cerbos.dev/v1
resourcePolicy:
  version: "default"
  resource: "list-resources:leave_request"
  rules:
    - actions: ["create", "view", "submit"]
      roles: ["employee"]
      effect: EFFECT_ALLOW
      condition:
        match:
          expr: R.attr.owner == request.principal.id
    - actions: ["approve"]
      roles: ["manager"]
      effect: EFFECT_ALLOW
      condition:
        match:
          all:
            of:
              - expr: 1 == 1
              - expr: R.attr.status == "PENDING_APPROVAL"
              - expr: R.attr.owner != request.principal.id
              - any:
                  of:
                    - expr: 1 != 1
                    - expr: R.attr.geography == request.principal.attr.geography
                    - expr: R.attr.geography in request.principal.attr.managed_geographies