---
wantErrJson: |-
  {
    "disabled": null,
    "duplicateDefs": null,
    "loadFailures": null,
    "codegenFailures": [
      {
        "error": "principal.yaml: Failed to generate code for rule associated with resource 'leave_request' (#1) [failed to generate code for condition block of 'leave_request-rule-001': Invalid match expression: undeclared reference to 'XX' (in container '')]",
        "file": "principal.yaml"
      },
      {
        "error": "resource.yaml: Failed to generate code for rule 'approve_rule' (#1) [at least one role or derived role must be specified: code generation error]",
        "file": "resource.yaml"
      }
    ],
    "missingImports": null
  }
files:
  "test.txt": |-
    this is some text
  "resource.yaml": |-
    ---
    apiVersion: api.cerbos.dev/v1
    resourcePolicy:
      resource: leave_request
      rules:
        - name: approve_rule
          actions: ["approve"]
          effect: EFFECT_ALLOW
      version: "20210210"

  "principal.yaml": |-
    ---
    apiVersion: "api.cerbos.dev/v1"
    principalPolicy:
      principal: donald_duck
      version: "20210210"
      rules:
        - resource: leave_request
          actions:
            - action: "*"
              condition:
                match:
                  expr: "XX || request.resource.attr.dev_record == true"
              effect: EFFECT_ALLOW

        - resource: salary_record
          actions:
            - action: "*"
              effect: EFFECT_DENY
