# yaml-language-server: $schema=../.jsonschema/EngineTestCase.schema.json
---
description: "Role policies with conflicting ScopePermissions"
inputs:
  [
    {
      "requestId": "test",
      "actions": [
        "deny",
        "assist",
        ],
      "principal":
        {
          "id": "john",
          "scope": "acme.hr.uk",
          "roles": ["acme_admin", "acme_assistant"],
        },
      "resource":
        {
          "kind": "leave_request",
          "scope": "acme.hr.uk",
          "id": "XX125",
        },
    },
  ]
wantError: true
wantDecisionLogs:
  [
    {
      "callId": "01HGJXT9A4RMD9A7YG74146YV2",
      "timestamp": "2023-12-01T14:51:39.204970988Z",
      "checkResources":
        {
          "inputs":
            [
              {
                "requestId": "test",
                "resource":
                  {
                    "kind": "leave_request",
                    "id": "XX125",
                    "scope": "acme.hr.uk",
                  },
                "principal":
                  {
                    "id": "john",
                    "scope": "acme.hr.uk",
                    "roles": ["acme_admin", "acme_assistant"],
                  },
                "actions": ["deny", "assist"],
              },
            ],
          "error": "failed to get check for [leave_request]: invalid scope permissions: role policies cannot combine different scope permissions within the same scope", 
        },
    },
  ]

