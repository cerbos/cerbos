---
description: "Valid CheckResourceSet request"
wantStatus:
  httpStatusCode: 200
  grpcStatusCode: 0
playgroundProxy:
  input: {
    "playgroundId": "test",
    "policyFiles": [
      {
        "fileName": "roles_01.yaml",
        "contents": "LS0tCmFwaVZlcnNpb246ICJhcGkuY2VyYm9zLmRldi92MSIKZGVyaXZlZFJvbGVzOgogIG5hbWU6IGFscGhhCiAgZGVmaW5pdGlvbnM6CiAgICAtIG5hbWU6IGFkbWluCiAgICAgIHBhcmVudFJvbGVzOiBbImFkbWluIl0KCiAgICAtIG5hbWU6IHRlc3RlcgogICAgICBwYXJlbnRSb2xlczogWyJkZXYiLCAicWEiXQoKICAgIC0gbmFtZTogZW1wbG95ZWVfdGhhdF9vd25zX3RoZV9yZWNvcmQKICAgICAgcGFyZW50Um9sZXM6IFsiZW1wbG95ZWUiXQogICAgICBjb25kaXRpb246CiAgICAgICAgbWF0Y2g6CiAgICAgICAgICBleHByOiBSLmF0dHIub3duZXIgPT0gUC5pZAo=",
      },
      {
        "fileName": "roles_02.yaml",
        "contents": "LS0tCmFwaVZlcnNpb246ICJhcGkuY2VyYm9zLmRldi92MSIKdmFyaWFibGVzOgogIHNhbWVfZ2VvZ3JhcGh5OiByZXF1ZXN0LnJlc291cmNlLmF0dHIuZ2VvZ3JhcGh5ID09IHJlcXVlc3QucHJpbmNpcGFsLmF0dHIuZ2VvZ3JhcGh5CmRlcml2ZWRSb2xlczoKICBuYW1lOiBiZXRhCiAgZGVmaW5pdGlvbnM6CiAgICAtIG5hbWU6IGFueV9lbXBsb3llZQogICAgICBwYXJlbnRSb2xlczogWyJlbXBsb3llZSJdCgogICAgLSBuYW1lOiBkaXJlY3RfbWFuYWdlcgogICAgICBwYXJlbnRSb2xlczogWyJtYW5hZ2VyIl0KICAgICAgY29uZGl0aW9uOgogICAgICAgIG1hdGNoOgogICAgICAgICAgYWxsOgogICAgICAgICAgICBvZjoKICAgICAgICAgICAgICAtIGV4cHI6IFYuc2FtZV9nZW9ncmFwaHkKICAgICAgICAgICAgICAtIGV4cHI6IHJlcXVlc3QucmVzb3VyY2UuYXR0ci5nZW9ncmFwaHkgPT0gcmVxdWVzdC5wcmluY2lwYWwuYXR0ci5tYW5hZ2VkX2dlb2dyYXBoaWVzCg=="
      },
      {
        "fileName": "resource.yaml",
        "contents": "LS0tCmFwaVZlcnNpb246IGFwaS5jZXJib3MuZGV2L3YxCnZhcmlhYmxlczoKICBwZW5kaW5nX2FwcHJvdmFsOiAoIlBFTkRJTkdfQVBQUk9WQUwiKQogIHByaW5jaXBhbF9sb2NhdGlvbjogfC0KICAgIChQLmF0dHIuaXBfYWRkcmVzcy5pbklQQWRkclJhbmdlKCIxMC4yMC4wLjAvMTYiKSA/ICJHQiIgOiAiIikKcmVzb3VyY2VQb2xpY3k6CiAgdmVyc2lvbjogIjIwMjEwMjEwIgogIGltcG9ydERlcml2ZWRSb2xlczoKICAtIGFscGhhCiAgLSBiZXRhCiAgcmVzb3VyY2U6IGxlYXZlX3JlcXVlc3QKICBydWxlczoKICAtIGFjdGlvbnM6IFsnKiddCiAgICBlZmZlY3Q6IEVGRkVDVF9BTExPVwogICAgcm9sZXM6CiAgICAtIGFkbWluCiAgICBuYW1lOiB3aWxkY2FyZAoKICAtIGFjdGlvbnM6IFsiY3JlYXRlIl0KICAgIGRlcml2ZWRSb2xlczoKICAgIC0gZW1wbG95ZWVfdGhhdF9vd25zX3RoZV9yZWNvcmQKICAgIGVmZmVjdDogRUZGRUNUX0FMTE9XCgogIC0gYWN0aW9uczogWyJ2aWV3OioiXQogICAgZGVyaXZlZFJvbGVzOgogICAgLSBlbXBsb3llZV90aGF0X293bnNfdGhlX3JlY29yZAogICAgLSBkaXJlY3RfbWFuYWdlcgogICAgZWZmZWN0OiBFRkZFQ1RfQUxMT1cKCiAgLSBhY3Rpb25zOiBbInZpZXc6cHVibGljIl0KICAgIGRlcml2ZWRSb2xlczoKICAgIC0gYW55X2VtcGxveWVlCiAgICBlZmZlY3Q6IEVGRkVDVF9BTExPVwogICAgbmFtZTogcHVibGljLXZpZXcKCiAgLSBhY3Rpb25zOiBbImFwcHJvdmUiXQogICAgY29uZGl0aW9uOgogICAgICBtYXRjaDoKICAgICAgICBleHByOiByZXF1ZXN0LnJlc291cmNlLmF0dHIuc3RhdHVzID09IFYucGVuZGluZ19hcHByb3ZhbAogICAgZGVyaXZlZFJvbGVzOgogICAgICAtIGRpcmVjdF9tYW5hZ2VyCiAgICBlZmZlY3Q6IEVGRkVDVF9BTExPVwoKICAtIGFjdGlvbnM6IFsiZGVsZXRlIl0KICAgIGNvbmRpdGlvbjoKICAgICAgbWF0Y2g6CiAgICAgICAgZXhwcjogcmVxdWVzdC5yZXNvdXJjZS5hdHRyLmdlb2dyYXBoeSA9PSB2YXJpYWJsZXMucHJpbmNpcGFsX2xvY2F0aW9uCiAgICBkZXJpdmVkUm9sZXM6CiAgICAtIGRpcmVjdF9tYW5hZ2VyCiAgICBlZmZlY3Q6IEVGRkVDVF9BTExPVwoKICAtIGFjdGlvbnM6IFsiZGVmZXIiXQogICAgZWZmZWN0OiBFRkZFQ1RfQUxMT1cKICAgIHJvbGVzOiBbImVtcGxveWVlIl0KICAgIGNvbmRpdGlvbjoKICAgICAgbWF0Y2g6CiAgICAgICAgYWxsOgogICAgICAgICAgb2Y6CiAgICAgICAgICAgIC0gZXhwcjogJyJjZXJib3Mtand0LXRlc3RzIiBpbiByZXF1ZXN0LmF1eF9kYXRhLmp3dC5hdWQnCiAgICAgICAgICAgIC0gZXhwcjogJyJBIiBpbiByZXF1ZXN0LmF1eF9kYXRhLmp3dC5jdXN0b21BcnJheScK"
      },
      {
        "fileName": "principal.yaml",
        "contents": "LS0tCmFwaVZlcnNpb246ICJhcGkuY2VyYm9zLmRldi92MSIKcHJpbmNpcGFsUG9saWN5OgogIHByaW5jaXBhbDogZG9uYWxkX2R1Y2sKICB2ZXJzaW9uOiAiMjAyMTAyMTAiCiAgcnVsZXM6CiAgICAtIHJlc291cmNlOiBsZWF2ZV9yZXF1ZXN0CiAgICAgIGFjdGlvbnM6CiAgICAgICAgLSBhY3Rpb246ICIqIgogICAgICAgICAgY29uZGl0aW9uOgogICAgICAgICAgICBtYXRjaDoKICAgICAgICAgICAgICBleHByOiAicmVxdWVzdC5yZXNvdXJjZS5hdHRyLmRldl9yZWNvcmQgPT0gdHJ1ZSIKICAgICAgICAgIGVmZmVjdDogRUZGRUNUX0FMTE9XCgogICAgLSByZXNvdXJjZTogc2FsYXJ5X3JlY29yZAogICAgICBhY3Rpb25zOgogICAgICAgIC0gYWN0aW9uOiAiKiIKICAgICAgICAgIGVmZmVjdDogRUZGRUNUX0RFTlkK"
      }
    ],
    "checkResourceSet": {
      "requestId": "test",
      "includeMeta": true,
      "actions": [
        "view:public",
        "approve",
        "defer"
      ],
      "principal": {
        "id": "john",
        "policyVersion": "20210210",
        "roles": [
          "employee"
        ],
        "attr": {
          "department": "marketing",
          "geography": "GB",
          "team": "design"
        }
      },
      "resource": {
        "kind": "leave_request",
        "policyVersion": "20210210",
        "instances": {
          "XX125": {
            "attr": {
              "department": "marketing",
              "geography": "GB",
              "id": "XX125",
              "owner": "john",
              "team": "design"
            }
          }
        }
      },
      "auxData": {
        "jwt": {
          "token": "eyJhbGciOiJFUzM4NCIsImtpZCI6IjE5TGZaYXRFZGc4M1lOYzVyMjNndU1KcXJuND0iLCJ0eXAiOiJKV1QifQ.eyJhdWQiOlsiY2VyYm9zLWp3dC10ZXN0cyJdLCJjdXN0b21BcnJheSI6WyJBIiwiQiIsIkMiXSwiY3VzdG9tSW50Ijo0MiwiY3VzdG9tTWFwIjp7IkEiOiJBQSIsIkIiOiJCQiIsIkMiOiJDQyJ9LCJjdXN0b21TdHJpbmciOiJmb29iYXIiLCJleHAiOjE5NDk5MzQwMzksImlzcyI6ImNlcmJvcy10ZXN0LXN1aXRlIn0.WN_tOScSpd_EI-P5EI1YlagxEgExSfBjAtcrgcF6lyWj1lGpR_GKx9goZEp2p_t5AVWXN_bjz_sMUmJdJa4cVd55Qm1miR-FKu6oNRHnSEWdMFmnArwPw-YDJWfylLFX"
        }
      }
    }
  }
  wantResponse: {
    "playgroundId": "test",
    "checkResourceSet": {
      "requestId": "test",
      "resourceInstances": {
        "XX125": {
          "actions": {
            "view:public": "EFFECT_ALLOW",
            "approve": "EFFECT_DENY",
            "defer": "EFFECT_ALLOW"
          }
        }
      },
      "meta": {
        "resourceInstances": {
          "XX125": {
            "actions": {
              "view:public": {
                "matchedPolicy": "resource.leave_request.v20210210"
              },
              "approve": {
                "matchedPolicy": "resource.leave_request.v20210210"
              },
              "defer": {
                "matchedPolicy": "resource.leave_request.v20210210"
              }
            },
            "effectiveDerivedRoles": ["employee_that_owns_the_record", "any_employee"]
          }
        }
      }
    }
  }
